# Mini Zork Function and Routine Count Analysis

## Overview
This document provides a comprehensive count of all functions and routines that should be present in the compiled mini_zork game. This is used to verify disassembler correctness.

## User-Defined Functions (28)

### Core Game Functions
1. `handle_score/0` - Display current score
2. `handle_moves/0` - Display move count
3. `look_around/0` - Display room description and contents
4. `examine/1` - Examine an object
5. `handle_open/1` - Open an object
6. `handle_close/1` - Close an object
7. `handle_take/1` - Take an object (generic)
8. `handle_take/1` - Take leaflet (specialized)
9. `handle_take/1` - Take egg (specialized)
10. `handle_drop/1` - Drop an object (generic)
11. `handle_drop/1` - Drop egg (specialized)
12. `show_inventory/0` - Show player inventory
13. `handle_go/1` - Move in a direction
14. `handle_climb/1` - Climb an object (generic)
15. `handle_climb/1` - Climb tree (specialized)
16. `handle_read/1` - Read an object (generic)
17. `handle_read/1` - Read leaflet (specialized)
18. `handle_quit/0` - Initiate quit dialog
19. `handle_yes/0` - Confirm quit
20. `handle_no/0` - Cancel quit
21. `clear_quit_state/0` - Clear quit pending flag
22. `player_can_see/1` - Check if player can see object
23. `list_objects/1` - List objects in a location
24. `list_contents/1` - List contents of a container
25. `take_all/0` - Take all takeable objects
26. `init/0` - Initialize game state (implicit entry point)

### Room Event Handlers (automatically generated wrappers)
Rooms with event handlers in mini_zork:
- `west_of_house.on_enter` (1 handler defined)
- `behind_house.on_look` (1 handler defined)

Total: 2 room event handlers defined in source.

Note: These are typically compiled as inline code or simple wrappers, not separate routines.

## Builtin Functions (5)

These are system functions generated by the compiler:

1. `get_exit/1` - Get exit from a location (builtin)
2. `print_num/1` - Print integer (builtin)
3. `add_score/1` - Add points to score (builtin)
4. `subtract_score/1` - Subtract points from score (builtin)
5. `word_to_number/1` - Convert word to number (builtin)

## Grammar Action Functions

The grammar section defines 14+ verb handlers that call user functions:

Grammar verbs defined:
- "score" → `handle_score()`
- "moves" → `handle_moves()`
- "look" → `look_around()` or `examine($2)`
- "examine" → `examine($noun)`
- "open" → `handle_open($noun)`
- "close" → `handle_close($noun)`
- "take" → `handle_take($noun)` or `take_all()`
- "drop" → `handle_drop($noun)`
- "inventory" → `show_inventory()`
- "go" → `handle_go($noun)`
- "north" → `handle_go("north")`
- "south" → `handle_go("south")`
- "east" → `handle_go("east")`
- "west" → `handle_go("west")`
- "up" → `handle_go("up")`
- "down" → `handle_go("down")`
- "climb" → `handle_climb($noun)`
- "read" → `handle_read($noun)`
- "quit"/"exit"/"q" → `handle_quit()`
- "yes"/"y" → `handle_yes()`
- "no"/"n" → `handle_no()`

These grammar rules compile to dictionary entries and parse handlers, not separate user functions.

## Room Definitions (7)

1. `west_of_house` - Starting location with mailbox
2. `north_of_house` - North side of house
3. `south_of_house` - South side of house
4. `behind_house` - Behind the house with window
5. `forest_path` - Path through forest with tree
6. `up_a_tree` - High location in tree with nest
7. `forest` - Deep forest location
8. `clearing` - Forest clearing

Total: 8 room objects (note: clearing is simple with no special features)

## Object Definitions (9)

1. `mailbox` (in west_of_house) with:
   - `leaflet` (contained within mailbox)
2. `tree` (in forest_path)
3. `window` (in behind_house)
4. `nest` (in up_a_tree) with:
   - `egg` (contained within nest)

Total object count: 9 objects

## Expected Routine Count Summary

### Minimum Expected Routines (from user code)
- 26 user-defined functions (counting overloaded variants as separate)
- 5 builtin functions
- 1 init function (main)
- **Subtotal: 32 routines**

### Potential Additional Routines
- Room initialization routines (if generated)
- Grammar handler dispatch functions
- Parser/lexer utilities

### Maximum Expected Routines
Conservative estimate: **35-45 total routines** depending on how the compiler generates room and grammar infrastructure.

## Disassembler Verification

When disassembling mini_zork.z3:
1. Scan for Z-Machine function headers (routine address words in the game header)
2. Look for code sections that match the 28 user functions listed above
3. Verify builtin functions are properly generated (get_exit, print_num, add_score, subtract_score, word_to_number)
4. Check that room event handlers are either inlined or wrapped properly
5. Verify init function exists as game entry point

## Function Overloading in Grue

Mini Zork uses function overloading for several functions:
- `handle_take/1` - 3 versions (generic, leaflet, egg)
- `handle_drop/1` - 2 versions (generic, egg)
- `handle_climb/1` - 2 versions (generic, tree)
- `handle_read/1` - 2 versions (generic, leaflet)

Depending on how the compiler handles overloading:
- Each overload may compile to a separate routine
- Or they may be merged with type/object checking

This affects the final routine count in the compiled output.
