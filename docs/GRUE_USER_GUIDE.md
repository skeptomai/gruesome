# Writing and Running Grue Games: A Beginner's Guide

## What is Grue?

Grue is a high-level programming language designed specifically for creating text adventure games (interactive fiction). It compiles to Z-Machine bytecode, the same format used by classic Infocom games like Zork, making your games playable on any Z-Machine interpreter.

## Basic Grue Game Structure

Every Grue game consists of several key sections:

### 1. Minimal Example (`test_simple.grue`)

The simplest possible Grue program:

```grue
init {
    print("Simple test program");
}
```

The `init` block is the entry point - code here runs when the game starts.

### 2. Basic Game with World (`basic_test.grue`)

```grue
// Comments use // syntax
world {
    room test_room "Test Room" {
        desc: "This is a simple test room."
        exits: {}
    }
}

fn test_function() {
    print("Hello from test function!");
}

init {
    print("Basic Grue Compiler Test");
    print("Version 1.0 - Generated by grue-compiler");
    test_function();
    print("Test completed successfully!");
}
```

### 3. Key Language Features

**Functions**: Define reusable code blocks
```grue
fn my_function() {
    print("Function called!");
}
```

**World Definition**: Create rooms and objects
```grue
world {
    room kitchen "Kitchen" {
        desc: "A cozy kitchen with modern appliances."
        exits: {
            north: living_room,
            east: dining_room
        }
    }
}
```

**Objects**: Items players can interact with
```grue
object mailbox {
    names: ["small mailbox", "mailbox", "box"]
    desc: "The small mailbox is closed."
    openable: true
    container: true
}
```

**Built-in Functions**: 
- `print("text")` - Display text to player
- `move(object, location)` - Move objects around
- `get_location(object)` - Get an object's current location

## Compiling Your Game

### Step 1: Build the Compiler

First, ensure the Grue compiler is built:

```bash
cargo build --release
```

### Step 2: Compile Your Game

The compiler binary is `grue-compiler`. To compile a `.grue` file:

```bash
# Compile to Z-Machine version 3 (default)
cargo run --bin grue-compiler your_game.grue

# Specify target version explicitly
cargo run --bin grue-compiler -- --target v3 your_game.grue
cargo run --bin grue-compiler -- --target v5 your_game.grue
```

This creates a `.z3` (or `.z5`) file - your compiled game!

### Step 3: Test Compilation

Try compiling the included examples:

```bash
# Simple test
cargo run --bin grue-compiler examples/test_simple.grue

# More complex example
cargo run --bin grue-compiler examples/basic_test.grue
```

## Running Your Game

### Using the Built-in Gruesome Interpreter

This project includes `gruesome`, a Z-Machine interpreter specifically designed for running your compiled games:

```bash
# Run with info-level logging
RUST_LOG=info cargo run --bin gruesome your_game.z3

# Run with debug logging (shows detailed execution)
RUST_LOG=debug cargo run --bin gruesome your_game.z3

# Run examples
RUST_LOG=info cargo run --bin gruesome basic_test.z3
RUST_LOG=info cargo run --bin gruesome examples/test_simple.z3
```

### Using Other Z-Machine Interpreters

Since Grue compiles to standard Z-Machine bytecode, your games work with any Z-Machine interpreter:

- **Frotz** (command-line)
- **Gargoyle** (GUI)
- **Zoom** (macOS)
- **WinFrotz** (Windows)
- **Online interpreters** like Parchment

## Complete Workflow Example

### 1. Create Your Game File

Create `my_first_game.grue`:

```grue
world {
    room start_room "Starting Room" {
        desc: "You are in a small, cozy room with a single exit to the north."
        exits: {
            north: second_room
        }
    }
    
    room second_room "Second Room" {
        desc: "This is another room. You can go back south."
        exits: {
            south: start_room
        }
    }
}

init {
    print("Welcome to My First Game!");
    print("Type commands like 'north', 'south', or 'look'.");
    player.location = start_room;
    print("");
    print(start_room.desc);
}
```

### 2. Compile It

```bash
cargo run --bin grue-compiler my_first_game.grue
```

### 3. Run It

```bash
RUST_LOG=info cargo run --bin gruesome my_first_game.z3
```

## Debugging Tips

### Compilation Errors
- Use `RUST_LOG=debug` with the compiler to see detailed compilation steps
- Check syntax carefully - Grue is case-sensitive
- Ensure all referenced rooms/objects are defined

### Runtime Issues
- Use `RUST_LOG=debug` with gruesome to see execution details
- Check that `player.location` is set in your `init` block
- Verify all object references are correct

## What's Next?

- Study `examples/mini_zork.grue` for advanced features
- Learn about object properties (`openable`, `container`, etc.)
- Explore grammar definitions for custom commands
- Add interactive elements and complex game logic

The Grue language is designed to make text adventure creation accessible while generating efficient, compatible Z-Machine code that preserves the classic interactive fiction experience.