# Property 28 Boolean Interpretation Fix Plan

## Current Status: MAJOR SUCCESS ‚úÖ
**Property 28 access issue COMPLETELY RESOLVED** - game loads successfully, welcome banner displays correctly.

## Remaining Issue: Boolean Value Misinterpretation

**Problem**: Property 28 boolean value `0x0000` is being passed to `print_paddr`, causing:
```
üö® COMPILER BUG: print_paddr called with invalid packed address 0x0000 at PC 011f2!
```

**Root Cause**: Code generation treats Property 28 value as string address instead of boolean value.

## Issue Analysis

### ‚úÖ What's Working
- Property 28 exists and is accessible at runtime
- Property 28 contains correct boolean value (0x0000 = false)
- Object property table pointers correctly adjusted
- Game loads and shows welcome banner

### ‚ùå What's Broken
- Property 28 value (0x0000) passed to `print_paddr` as string address
- Should be interpreted as boolean, not printed as string
- Causes panic when interpreter tries to print at address 0x0000

## Investigation Strategy

### Phase 1: Identify the Print Operation (10 minutes)
**Goal**: Find where Property 28 value is being printed as string

**Method**:
1. **Trace PC 011f2**: Find what instruction at 011f2 calls print_paddr
2. **Check IR**: Use `--print-ir` to see what generates this print operation
3. **Property Usage**: Find where `quit_pending` property is being used in print context

**Commands**:
```bash
# Check IR for print operations involving Property 28
RUST_LOG=error ./target/debug/grue-compiler examples/mini_zork.grue --print-ir | grep -A5 -B5 "property.*28\|quit_pending"

# Check generated bytecode around PC 011f2
RUST_LOG=error timeout 2 ./target/debug/gruesome tests/mini_zork.z3 -- --disasm-range 0x011f0-0x011f8
```

### Phase 2: Analyze Code Generation (15 minutes)
**Goal**: Understand why boolean property generates print instruction

**Investigation Points**:
1. **Property Access Pattern**: How is `quit_pending` property being accessed?
2. **Print Context**: Is this a debug print, conditional print, or property display?
3. **IR Instructions**: What IR generates the problematic print_paddr?

**Likely Scenarios**:
- Property examination code incorrectly prints boolean values
- Debug/trace code printing property contents
- Conditional print where boolean should control printing, not be printed

### Phase 3: Fix Code Generation (20 minutes)
**Goal**: Modify code generation to handle boolean properties correctly

**Expected Fix Locations**:
- `codegen_instructions.rs` - Property access instruction generation
- `codegen_builtins.rs` - Built-in function handling for property operations
- Property examination/display functions

**Fix Strategy**:
1. **Identify the specific instruction** that generates print_paddr for Property 28
2. **Add boolean property check** - if property contains boolean, don't print as string
3. **Alternative handling** - either skip print or print boolean representation

### Phase 4: Verification (5 minutes)
**Goal**: Confirm fix resolves issue without regression

**Tests**:
1. Game loads without panic
2. Property 28 functionality works (quit behavior)
3. Other property printing still works
4. No regression in game startup

## Expected Timeline: 50 minutes total

This is a straightforward code generation fix compared to the complex property table corruption we just resolved.

## Success Criteria

‚úÖ **Primary**: Game loads completely without panic
‚úÖ **Secondary**: Property 28 boolean logic works correctly
‚úÖ **Regression**: Other property operations unaffected

## File Targets

**Primary Investigation**:
- `src/grue_compiler/codegen_instructions.rs` - Instruction generation
- `examples/mini_zork.grue` - Source context for `quit_pending` usage

**Secondary Targets**:
- `src/grue_compiler/codegen_builtins.rs` - Built-in function handling
- `src/grue_compiler/ir.rs` - IR instruction analysis

## Notes

This is a **simpler fix** than the property table corruption. The core property system now works correctly - we just need to fix how boolean property values are handled in print operations.

**Next Steps**: Begin Phase 1 investigation to identify the exact print operation source.